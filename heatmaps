

# Install and load required packages
install.packages(c("ggplot2", "dplyr", "viridis"))

library(ggplot2)
library(dplyr)
library(viridis)

##### Create a heatmap of the measurements frequency of all the parameters at once.
## Following code creates one heatmap, representing the frequency of measurements throughout all stations and in all the years represented in your dataset together.
# Dataset must have columns: ' stationname' and 'Year'.

# Create a frequency table
#This table represents the stations per year where measurements have been taken.
frequency_table <- DefoExp %>%
  group_by(stationname, Year) %>%
  summarise(frequency = n())

# Create a heatmap
heatmap_plotGen <- ggplot(frequency_table, aes(x = stationname, y = Year, fill = frequency)) +
  geom_tile() +
  scale_fill_gradient(low = "beige", high = "darkgreen") +
  labs(x = "Station", y = "Year", title = "Parameter Frequency Heatmap")

# Display the plot
print(heatmap_plotGen)


##### Now create one heatmap per parameter.
# columns the dataset must have: 'stationname', 'Year', 'standardparameterId', 'Latitude', 'Longitude', 'datetime' , and parameters to be represented.

# Gather all the parameter columns in one table excluding columns such: 'stationname', 'year', etc.
param_columns <- colnames(DefoExp)[!(colnames(DefoExp) %in% c('stationname', 'Year', 'standardparameterId', 'Latitude', 'Longitude', 'datetime'))]

# Loop over each parameter column and create a heatmap
for (param in param_columns) {
  # Create a frequency table
  frequency_table <- DefoExp %>%
    group_by(stationname, Year, !!sym(param)) %>%
    summarise(frequency = n())
  
  # Create a heatmap for the current parameter
  heatmap_plot <- ggplot(frequency_table, aes(x = stationname, y = Year, fill = frequency)) +
    geom_tile() +
    scale_fill_gradient(low = "beige", high = "darkgreen") +
    labs(x = "Station", y = "Year", title = paste("Parameter:", param, "Frequency Heatmap"))
  
  # Display the plot or save it to a file
  print(heatmap_plot)
  # ggsave(paste0("heatmap_", param, ".png"), plot = heatmap_plot)  # Uncomment this line to save the plot to a file
}

